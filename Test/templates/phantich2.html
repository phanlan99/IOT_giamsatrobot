<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplement Detection Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <!-- Header -->
        <header class="bg-white shadow rounded-lg p-6 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <span class="text-3xl mr-2">üìä</span>
                    <div>
                        <h1 class="text-2xl font-bold">Supplement Analysis</h1>
                        <p class="text-gray-600">Bar Chart for Specific Date</p>
                    </div>
                </div>
                <div>
                    {% if username %}
                        <p class="text-gray-700">Welcome, {{ username }}!</p>
                        <a href="{{ url_for('logout') }}" class="text-blue-500 hover:underline">Logout</a>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="text-blue-500 hover:underline mr-4">Login</a>
                        <a href="{{ url_for('register') }}" class="text-blue-500 hover:underline">Register</a>
                    {% endif %}
                </div>
            </div>
        </header>

        <!-- Back Button -->
        <a href="{{ url_for('history') }}" class="text-blue-500 hover:underline mb-4 inline-block">‚Üê Back to History</a>

        <!-- Date Selection -->
        <section class="bg-white shadow rounded-lg p-6 mb-6">
            <div class="flex items-center mb-4">
                <span class="text-2xl mr-2">üîç</span>
                <h2 class="text-xl font-semibold">Select Date for Analysis</h2>
            </div>
            <form action="{{ url_for('phantich') }}" method="POST" class="flex items-center">
                <input type="date" name="analysis_date" value="{{ selected_date or '' }}" class="w-full md:w-1/3 border rounded-lg p-2 mr-2">
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Analyze</button>
            </form>
        </section>

        <!-- Bar Chart -->
        <section class="bg-white shadow rounded-lg p-6">
            <div class="flex items-center mb-4">
                <span class="text-2xl mr-2">üìà</span>
                <h2 class="text-xl font-semibold">Supplement Counts for {% if selected_date %}{{ selected_date }}{% else %}Selected Date{% endif %}</h2>
            </div>
            <canvas id="supplementChart" width="400" height="200"></canvas>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const data = {{ data | tojson }};
            const labels = ['Beroca', 'Cachua', 'Cam', 'Egg', 'Maleutyl', 'Probio', 'Sui', 'Topralsin', 'Vitatrum', 'ZidocinDHG'];
            const counts = labels.map(label => {
                return data.reduce((sum, row) => sum + (row[label.toLowerCase()] || 0), 0);
            });

            const ctx = document.getElementById('supplementChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Supplement Counts',
                        data: counts,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Count'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Supplement Type'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>